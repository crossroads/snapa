<!DOCTYPE html>
<head>
<meta charset="utf-8">
<style>

body {
  margin: 0;
}
.subunit {
  fill: #D7D7D7;
  stroke: #F2F2F2;
  stroke-width: 2;
}
.subunit.highlight {
  fill: #658436;
}

</style>
</head>
<body>
<script src="d3.v3.min.js"></script>
<script src="topojson.v1.min.js"></script>
<script>

function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}

var countries = (getParameterByName('c') || 'TZ').toUpperCase().split(','),
    width = getParameterByName('w') || 380,
    height = getParameterByName('h') || 230,
    percent = getParameterByName('p') || .95,
    maxScale = getParameterByName('m') || 300;

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

var projection = d3.geo.mercator()
    .scale(1)
    .translate([0, 0]);

var path = d3.geo.path()
    .projection(projection);

d3.json("countries.json", function(error, world) {
  var bounds = [[Number.MAX_VALUE, Number.MAX_VALUE], [Number.MIN_VALUE, Number.MIN_VALUE]],
      features = topojson.feature(world, world.objects.countries).features;

  for (var i = 0; i < features.length; i++) {
    if (countries.indexOf(features[i].id) !== -1) {
      var b = path.bounds(features[i]);
      bounds = [
        [Math.min(bounds[0][0], b[0][0]), Math.min(bounds[0][1], b[0][1])],
        [Math.max(bounds[1][0], b[1][0]), Math.max(bounds[1][1], b[1][1])]
      ];
    }
  }

  var scale = percent / Math.max((bounds[1][0] - bounds[0][0]) / width, (bounds[1][1] - bounds[0][1]) / height),
      scale = Math.min(scale, maxScale),
      translate = [(width - scale * (bounds[1][0] + bounds[0][0])) / 2, (height - scale * (bounds[1][1] + bounds[0][1])) / 2];

  projection
      .scale(scale)
      .translate(translate);

  svg.selectAll("path")
      .data(features)
      .enter().append("path")
        .attr("class", function(d) { return "subunit " + d.id + (countries.indexOf(d.id) !== -1 ? ' highlight' : ''); })
        .attr("d", path);
});

</script>
</body>
</html>
